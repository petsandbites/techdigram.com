<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagram Editor</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/simple-icons@v9/icons/amazonaws.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>☁️ AI-Powered Diagram Editor</h1>
            <div class="api-key-section">
                <input type="password" id="apiKeyInput" class="api-key-input" placeholder="Enter your Google Gemini API key (AIza...)">
                <i class="fas fa-info-circle info-icon" id="infoIcon" title="How to get API key"></i>
                <span id="apiStatus" class="api-status">No API key</span>
            </div>
        </div>
        
        <div class="ai-panel" id="aiPanel">
            <div class="ai-prompt-container">
                <textarea id="aiPromptInput" class="ai-prompt-input" placeholder="Describe how you want to modify your diagram (e.g., 'Add a Redis cache between the load balancer and EC2', 'Convert this to use Lambda functions instead of EC2')..."></textarea>
                <button id="aiSendBtn" class="ai-send-btn" disabled>Ask AI</button>
            </div>
            <div id="aiResponse" class="ai-response">
                <div id="aiResponseText" class="ai-response-text"></div>
                <div class="ai-actions">
                    <button id="applyBtn" class="apply-btn">Apply Changes</button>
                </div>
            </div>
        </div>
        
        <div class="editor-container">
            <div class="input-panel">
                <div class="input-header">
                    <span>Code</span>
                    <div class="template-buttons">
                        <button class="template-btn" data-template="basic">Basic Flow</button>
                        <button class="template-btn" data-template="lambda">Lambda@Edge</button>
                        <button class="template-btn" data-template="microservices">Microservices</button>
                    </div>
                </div>
                <div class="aws-guide">
                    <h4>Icons Guide:</h4>
                    <strong>Compute:</strong> <i class="fab fa-aws"></i> EC2 <i class="fas fa-bolt"></i> Lambda <i class="fab fa-docker"></i> ECS <i class="fas fa-dharmachakra"></i> EKS<br>
                    <strong>Storage:</strong> <i class="fas fa-database"></i> S3 <i class="fas fa-server"></i> RDS <i class="fas fa-table"></i> DynamoDB <i class="fas fa-folder"></i> EFS<br>
                    <strong>Network:</strong> <i class="fas fa-cloud"></i> CloudFront <i class="fas fa-balance-scale"></i> ALB <i class="fas fa-globe"></i> Route53 <i class="fas fa-shield-alt"></i> VPC<br>
                    <strong>Security:</strong> <i class="fas fa-user-shield"></i> IAM <i class="fas fa-key"></i> Cognito <i class="fas fa-lock"></i> KMS <i class="fas fa-shield-alt"></i> WAF
                </div>
                <textarea 
                    id="mermaidInput" 
                    class="mermaid-input" 
                    placeholder="Enter your AWS architecture code here...">graph TD
    User["<i class='fas fa-user'></i><br/>User"] --> DNS["<i class='fas fa-globe'></i><br/>Route 53"]
    DNS --> CF["<i class='fas fa-cloud'></i><br/>CloudFront"]
    CF --> LE["<i class='fas fa-bolt'></i><br/>Lambda@Edge"]
    LE --> ALB["<i class='fas fa-balance-scale'></i><br/>Load Balancer"]
    ALB --> EC2["<i class='fab fa-aws'></i><br/>EC2 Instance"]
    EC2 --> RDS["<i class='fas fa-server'></i><br/>RDS Database"]
    
    subgraph "AWS Cloud"
        CF
        LE
        ALB
        EC2
        RDS
    end</textarea>
            </div>
            
            <div class="output-panel">
                <div class="output-header">
                    <span>Diagram Preview</span>
                    <button id="clearBtn" class="clear-btn">Clear</button>
                </div>
                <div id="mermaidOutput" class="mermaid-output">
                    <div class="loading">Loading diagram...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Instructions Popup -->
    <div class="popup-overlay" id="popupOverlay"></div>
    <div class="instructions-popup" id="instructionsPopup">
        <div class="popup-header">
            <h3 class="popup-title">How to Get Google Gemini API Key</h3>
            <button class="close-btn" id="closePopup">&times;</button>
        </div>
        <div class="popup-content">
            <h4>Step-by-Step Instructions:</h4>
            <ol>
                <li>Go to <strong>Google AI Studio</strong>: <code>https://makersuite.google.com/app/apikey</code></li>
                <li>Sign in with your Google account</li>
                <li>Click <strong>"Create API Key"</strong></li>
                <li>Choose <strong>"Create API key in new project"</strong> (recommended)</li>
                <li>Copy the generated API key (starts with <code>AIza</code>)</li>
                <li>Paste it into the API key field above</li>
            </ol>
            
            <h4>Enable the API:</h4>
            <ol>
                <li>Go to <strong>Google Cloud Console</strong>: <code>https://console.cloud.google.com/</code></li>
                <li>Select your project (or create one)</li>
                <li>Go to <strong>APIs & Services > Library</strong></li>
                <li>Search for <strong>"Generative Language API"</strong></li>
                <li>Click on it and press <strong>"Enable"</strong></li>
            </ol>
            
            <div class="warning">
                <strong>Note:</strong> The API key must have the Generative Language API enabled to work. If you get a 404 error, make sure you've enabled the API in Google Cloud Console.
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
