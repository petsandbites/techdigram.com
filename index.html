<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagram Editor</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- CodeMirror for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/mode/simple.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Compact Top Bar -->
        <div class="top-bar">
            <div class="app-title">
                <h1>üèóÔ∏è AWS Diagram Editor</h1>
            </div>
            <div class="top-controls">
                <div class="api-section">
                    <span id="apiStatus" class="status-dot">‚ö™</span>
                    <input type="password" id="apiKeyInput" placeholder="API Key" class="api-input">
                    <button id="saveApiKey" class="api-save-btn">Save</button>
                </div>
                <button class="theme-toggle" id="themeToggle">üåô</button>
                <button class="info-btn" id="iconsInfoBtn" title="Show AWS Icons Reference">‚ÑπÔ∏è</button>
                <button class="ai-toggle" id="aiToggle">üí¨ AI</button>
            </div>
        </div>
        
        <!-- Main Split Layout -->
        <div class="main-content">
            <div class="input-panel">
                <div class="input-header">
                    <span>Mermaid Code Editor</span>
                    <div class="controls">
                        <button id="clearBtn" class="control-btn">Clear</button>
                        <button id="fullscreenBtn" class="control-btn">‚õ∂ Fullscreen</button>
                    </div>
                </div>
                <div class="editor-container">
                    <!-- Removed undo/redo toolbar -->
                    <div id="codeEditor" class="code-editor"></div>
                </div>
            </div>
            
            <div class="diagram-panel">
                <div class="diagram-header">
                    <span>Diagram Preview</span>
                    <button id="exitFullscreenBtn" class="exit-fullscreen-btn" style="display: none;">‚úï</button>
                </div>
                <div id="diagramContainer" class="diagram-container">
                    <div id="mermaidOutput" class="mermaid-output">
                        <div class="loading">Loading diagram...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Floating AI Chat -->
        <div class="ai-chat-float" id="aiChatFloat">
            <div class="ai-chat-header">
                <span>‚ú® AI Assistant</span>
                <button class="ai-close" id="aiCloseBtn">√ó</button>
            </div>
            <div class="ai-chat-content">
                <textarea 
                    id="aiPromptInput" 
                    placeholder="Describe how you want to modify your diagram..." 
                    class="ai-prompt-input"
                ></textarea>
                <button id="generateBtn" class="generate-btn">Ask AI</button>
            </div>
        </div>
        
        <textarea 
            id="mermaidInput" 
            class="mermaid-input hidden" 
            placeholder="Enter your AWS architecture code here..."
            spellcheck="false">graph TD
    {{User}} --> {{Route53}}
    {{Route53}} --> {{CloudFront}}
    {{CloudFront}} --> {{Lambda}}
    {{Lambda}} --> {{ALB}}
    {{ALB}} --> {{EC2}}
    {{EC2}} --> {{RDS}}
    
    subgraph "AWS Cloud"
        {{CloudFront}}
        {{Lambda}}
        {{ALB}}
        {{EC2}}
        {{RDS}}
    end</textarea>
        
        <!-- AWS Icons Reference Popup -->
        <div class="icons-popup" id="iconsPopup">
            <div class="popup-header">
                <h3 class="popup-title">AWS Icons Reference</h3>
                <button class="close-btn" id="closeIconsPopup">&times;</button>
            </div>
            <div class="popup-content">
                <div class="icons-grid">
                    <div class="icon-category">
                        <h4>Compute</h4>
                        <div class="icon-item"><code>{{EC2}}</code> - EC2 Instance</div>
                        <div class="icon-item"><code>{{Lambda}}</code> - Lambda Function</div>
                        <div class="icon-item"><code>{{ECS}}</code> - ECS Container</div>
                    </div>
                    <div class="icon-category">
                        <h4>Storage</h4>
                        <div class="icon-item"><code>{{S3}}</code> - S3 Bucket</div>
                        <div class="icon-item"><code>{{EBS}}</code> - EBS Volume</div>
                        <div class="icon-item"><code>{{EFS}}</code> - EFS File System</div>
                    </div>
                    <div class="icon-category">
                        <h4>Database</h4>
                        <div class="icon-item"><code>{{RDS}}</code> - RDS Database</div>
                        <div class="icon-item"><code>{{DynamoDB}}</code> - DynamoDB</div>
                        <div class="icon-item"><code>{{ElastiCache}}</code> - ElastiCache</div>
                    </div>
                    <div class="icon-category">
                        <h4>Networking</h4>
                        <div class="icon-item"><code>{{VPC}}</code> - VPC</div>
                        <div class="icon-item"><code>{{ALB}}</code> - Load Balancer</div>
                        <div class="icon-item"><code>{{CloudFront}}</code> - CloudFront</div>
                        <div class="icon-item"><code>{{Route53}}</code> - Route 53</div>
                        <div class="icon-item"><code>{{APIGateway}}</code> - API Gateway</div>
                    </div>
                    <div class="icon-category">
                        <h4>Security</h4>
                        <div class="icon-item"><code>{{IAM}}</code> - IAM</div>
                        <div class="icon-item"><code>{{WAF}}</code> - WAF</div>
                        <div class="icon-item"><code>{{KMS}}</code> - KMS</div>
                    </div>
                    <div class="icon-category">
                        <h4>General</h4>
                        <div class="icon-item"><code>{{User}}</code> - User</div>
                        <div class="icon-item"><code>{{Internet}}</code> - Internet</div>
                    </div>
                </div>
                <div class="usage-example">
                    <h4>Usage Example:</h4>
                    <pre><code>graph TD
    {{User}} --> {{Route53}}
    {{Route53}} --> {{CloudFront}}
    {{CloudFront}} --> {{ALB}}
    {{ALB}} --> {{EC2}}
    {{EC2}} --> {{RDS}}</code></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- Instructions Popup -->
    <div class="popup-overlay" id="popupOverlay"></div>
    <div class="instructions-popup" id="instructionsPopup">
        <div class="popup-header">
            <h3 class="popup-title">How to Get Google Gemini API Key</h3>
            <button class="close-btn" id="closePopup">&times;</button>
        </div>
        <div class="popup-content">
            <h4>Step-by-Step Instructions:</h4>
            <ol>
                <li>Go to <strong>Google AI Studio</strong>: <code>https://makersuite.google.com/app/apikey</code></li>
                <li>Sign in with your Google account</li>
                <li>Click <strong>"Create API Key"</strong></li>
                <li>Choose <strong>"Create API key in new project"</strong> (recommended)</li>
                <li>Copy the generated API key (starts with <code>AIza</code>)</li>
                <li>Paste it into the API key field above</li>
            </ol>
            
            <h4>Enable the API:</h4>
            <ol>
                <li>Go to <strong>Google Cloud Console</strong>: <code>https://console.cloud.google.com/</code></li>
                <li>Select your project (or create one)</li>
                <li>Go to <strong>APIs & Services > Library</strong></li>
                <li>Search for <strong>"Generative Language API"</strong></li>
                <li>Click on it and press <strong>"Enable"</strong></li>
            </ol>
            
            <div class="warning">
                <strong>Note:</strong> The API key must have the Generative Language API enabled to work. If you get a 404 error, make sure you've enabled the API in Google Cloud Console.
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
